# 6 属性赋值，层叠，和继承
## 6.1 指定，计算，和实际值
一旦用户代理解析文档并构造文档树，它必须给树的每个元素的每个应用到目标媒体类型的属性赋值。

属性的最终值是四步计算所得的结果：通过指定确定的值（指定值），再解析成用来继承的值（计算值），然后如果需要则转换成绝对值（应用值），根据本地环境的限制再最终转换（实际值）。
### 6.1.1 指定值
用户代理必须首先给每个属性赋一个指定值基于如下机制（按先后顺序）：

1. 如果层叠产生一个值，就使用它。除非，这个值是`inherit`，这个指定值由下面的“`inherit`值”定义。
2. 否则，如果属性是继承的且元素不是文档树的根，使用父元素的计算值。
3. 否则使用属性的初始值。每个属性的初始值在其定义中指明。
### 6.1.2 计算值
在层叠期间指定值被解析为计算值；例如URI被转换成绝对的以及`em`和`ex`单位被计算为像素或绝对长度。计算一个值绝对不需要用户代理渲染文档。

用户代理不能解析为绝对URI的URI的计算值为指定值。

属性的计算值通过其定义的Computed Value行被确定为指定的。

计算值存在甚至属性还未被应用，按照`Applies To`行所定义的。然而，有些属性定义元素其计算值依赖于其是否应用于元素。
### 6.1.3 应用值
计算值被处理尽可能不格式化文档。有些值，然而，只能在文档布局时确定。例如，如果元素的宽度设置为包含块的某个百分比，这个宽度不能确定知道包含块的宽度被确定。应用值是取计算值并把任何剩余的依赖解析为绝对值的结果。
### 6.1.4 实际值
原则上应用值即是用来渲染的值，但是用户代理可能在给定的环境中不能使用这个值。例如，用户代理可能只能以整数像素宽度渲染边框，然后可能因此必须近似于计算值，或者用户代理可能强制仅使用黑白阴影代替全彩。实际值是近似后的应用值。
## 6.2 继承
文档树中有些值通过元素的孩子继承而得，如同上面的描述。每个属性定义其是否是继承的。

[...]

当继承发生时，元素继承计算值。父元素的计算值成为孩子的指定值和计算值。

注意继承遵循文档树且不会被匿名盒拦截。
## 6.2.1 `inherit`值
每个属性也可能有个`inherit`的层叠值，意指，对于给定元素，该属性会把指定值看作元素父亲的计算值。`inherit`值可以被用来强制值的继承，而且也可以被用在不是常规继承的属性上。

如果`inherit`值设置在根元素上，则该属性被赋值为初始值。

[...]
## 6.3 @import规则
`@import`规则允许用户引入样式规则从其他样式表。在CSS 2.2中，任何@import规则必须在所有其他规则之前（除了@charet规则，如果存在）。See the section on parsing for when user agents must ignore @import rules。`@import`关键字必须跟着包含样式表的URI。字符串也是允许的；它会被解析就好像有url(...)围绕着它。

[...]

所以用户代理可以避免获取不支持的媒体类型的资源，作者可以指定媒体依赖的@import规则。

[...]

没有任何媒体类型时，引入是无条件的。给媒体指定`all`有同样的效果。引入只有当目标媒体匹配媒体列表时才生效。

如果媒体列表的项目之一时目标媒体或`all`则目标媒体匹配媒体列表。

注意媒体查询扩展了媒体列表的语法和匹配的定义。

当相同的样式表被引入或者在多处链接一个文档，用户代理必须处理（或者表现得处理）每个链接就好像链接是指向单独的样式表。
## 6.4 层叠
样式表可以有三个不同得来源：作者，用户，和用户代理。

- 作者。作者根据文档语言得约定指定源文档得样式表。例如，在HTML中，样式表可以被包含在文档中或外部链接。
- 用户。用户可以指定样式信息给特定得文档。例如，用户可以指定一个包含样式表的文件或者用户代理可以提供一个生成用户样式表的接口（或者表现得它做了）。
- 用户代理。用户代理必须应用一个默认样式表（或者表现得它做了）。用户代理的默认样式表应当呈现文档语言的元素以满足该文档语言通常的呈现预期的方式（例如，对于视觉浏览器，HTML中的EM元素以斜体呈现）。

注意用户可能修改系统设置（例如，系统颜色）影响到默认样式表。然而，有些用户代理实现无法改变默认样式表的值。

这三种来源的样式表会在作用域中重叠，且它们相互影响根据层叠。

CSS层叠给每个样式规则分配了权重。当几个规则应用时，权重最大的那个优先。

默认情况下，作者样式表的规则比用户样式表的规则有更高的权重。优先级被逆转，然而，对于`!important`规则。所有用户和作者的规则比用户代理的默认样式表的规则有更高的权重。
### 6.4.1 层叠顺序
为了找到元素/属性组合的值，用户代理必须应用如下排序顺序：

1. 找到应用到所涉及的元素和属性的所有声明，对于目标媒体。声明应用如果相关的选择器匹配所涉及的元素且目标媒体与包含声明的所有@media规则及得到了样式表的路径上的所有链接的样式列表相匹配。
2. 根据重要性（常规或重要）和来源（作者，用户，或用户代理）排序。递增顺序的优先级：
   1. 用户代理的声明
   2. 用户常规的声明
   3. 作者常规的声明
   4. 作者重要的声明
   5. 用户重要的声明
3. 相同重要性和来源的规则排序根据选择器的特殊性：更特殊的选择器会覆盖更一般的。伪元素和伪类各自算作常规的元素和类。
4. 最后，通过指定的顺序排序：如果两个声明有相同的权重，来源和特殊性，则后制定的胜利。引入的样式表中的声明被认为在样式表自身的任何声明之前。

除了给个别的声明设置`!important`，这个策略给了作者的样式表比那些阅读器更高的权重。用户代理必须给用户能力以关闭特殊的作者的样式表的效果，例如，通过一个下拉菜单。
### 6.4.2 !important规则
CSS试图在作者和用户样式表之间创建一种力量的平衡。默认情况下，作者样式表的规则覆盖用户样式表的（见层叠规则3）。

然而，为了平衡，`!important`声明（分隔符令牌`!`和关键字`important`接着此声明）优先于常规声明。作者和用户的样式表可以都包含`!important`声明，且用户的`!important`规则覆盖作者的`important`规则。这个CSS特点改善了文档的可访问性通过允许用户以特殊需求（大字体，颜色组合，等等）控制展示。

声明一个简写属性（例如，`background`）为`!important`与声明其所有子属性为`!important`等价。

[...]
### 6.4.3 计算选择器的特殊性
选择器的特殊性被计算按照：

- 计数1如果声明来自`style`属性而不是选择器的规则，否则0（= a）（在HTML中，元素的`style`属性的值是样式表规则。这些规则没有选择器，所以a=1，b=0，c=0，以及d=0。）
- 计数选择器中ID属性的个数（= b）
- 计数选择器中其他属性和伪类的个数（= c）
- 计数选择器中元素名称和伪元素的个数（= d）

特殊性只基于选择器的形式。特别的，形式为`[id=p33]`的选择器被算作是一个属性的选择器（a=0，b=0，c=1，d=0），即使id属性在源文档的文件类型定义中定义为`ID`。

连接四个数字a-b-c-d等到特殊性。

[...]
### 6.4.4 Precedence of non-CSS presentational hints
[...]